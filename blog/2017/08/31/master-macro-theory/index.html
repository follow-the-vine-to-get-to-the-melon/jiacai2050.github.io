<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Do have faith in what you are doing."><title>由浅入深学习 Lisp 宏之理论篇 | Keep Coding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-50745138-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '3ffc15f400ce3f8b1db5afc4f29b6ce9';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">由浅入深学习 Lisp 宏之理论篇</h1><a id="logo" href="/.">Keep Coding</a><p class="description">Stay hungry, Stay foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/blogrolls/"><i class="fa fa-group"> 友情链接</i></a><a href="/podcast/"><i class="fa fa-podcast"> Podcast</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">由浅入深学习 Lisp 宏之理论篇</h1><div class="post-meta">Aug 31, 2017<span> | </span><span class="category"><a href="/categories/langs/">编程语言</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 8</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" data-disqus-identifier="blog/2017/08/31/master-macro-theory/" href="/blog/2017/08/31/master-macro-theory/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本语法"><span class="toc-number">1.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#结构与语义"><span class="toc-number">1.1.</span> <span class="toc-text">结构与语义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#quote"><span class="toc-number">2.</span> <span class="toc-text">quote</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宏的本质"><span class="toc-number">3.</span> <span class="toc-text">宏的本质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#求值过程"><span class="toc-number">4.</span> <span class="toc-text">求值过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">4.1.</span> <span class="toc-text">Java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Clojure"><span class="toc-number">4.2.</span> <span class="toc-text">Clojure</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><p>宏（macro）是 Lisp 语言中最重要的武器，它可以自动生成运行时的代码。宏也是编写领域特定语言（DSL）的利器，可以在不改动语言本身的基础上，增加新的程序构造体，这在其他语言中是不可能。比如，现在比较流行的同步方式写异步代码的 async/await，在非 Lisp 语言需要语言本身支持，但是在 Lisp 里面可以通过几个宏来解决，可以参考：<a href="https://github.com/clojure/core.async" target="_blank" rel="noopener">core.async</a>。</p>
<blockquote>
<p>With great power comes great responsibility.</p>
</blockquote>
<p>由于宏的强大，掌握编写它的方法有较大的难度，所以社区一般会建议能不用就不要用它，我个人也比较认同这一点，但是对于一些场景用宏确实也很方便，能使程序简洁明了，所以还是有必要掌握它的，等有一定经验，就可以知道在什么场景下使用最合适了。</p>
<p>为了由浅入深、系统地介绍宏，打算分两篇文章来介绍，第一篇为理论篇，主要介绍 </p>
<ol>
<li>Clojure 语言中的基本语法，重点介绍 Symbol 数据类型，为什么需要它，非 Lisp 语言为什么没有</li>
<li>宏的本质，宏运行时期</li>
</ol>
<p>第二篇是实战篇，介绍宏的一些常见技巧以及一些通用宏。这两篇均以 Clojure 方言为示例，但其概念原理在其他 Lisp 中都是相通的。本文为第一篇。</p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>Clojure 作为一门 Lisp 方言，其语言的基本单元是表达式（expression），通过不同表达式的组合形成最终的程序。非 Lisp 语言中除了「表达式」外，还有「声明（statement）」，声明没有返回值，只会产生一些副作用，比如<code>int a = 1</code>；而每个表达式都有一个返回值，极少数表达式具有副作用。Clojure 语言中有以下表达式字面量（literals）：</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;; Numeric types</span></span><br><span class="line"><span class="number">42</span>              <span class="comment">; Long - 64-bit integer (from -2^63 to 2^63-1)</span></span><br><span class="line">6.022e23        ; Double - double-precision 64-bit floating point</span><br><span class="line">42N             ; BigInt - arbitrary precision integer</span><br><span class="line">1.0M            ; BigDecimal - arbitrary precision fixed-point decimal</span><br><span class="line">22/7            ; Ratio</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Character types</span></span><br><span class="line"><span class="string">"hello"</span>         <span class="comment">; String</span></span><br><span class="line">\e              ; Character</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Other types</span></span><br><span class="line"><span class="literal">nil</span>             <span class="comment">; null value</span></span><br><span class="line"><span class="literal">true</span>            <span class="comment">; Boolean (also, false)</span></span><br><span class="line">#"[0-9]+"       ; Regular expression</span><br><span class="line"><span class="symbol">:alpha</span>          <span class="comment">; Keyword</span></span><br><span class="line"><span class="symbol">:release/alpha</span>  <span class="comment">; Keyword with namespace</span></span><br><span class="line">map             ; Symbol</span><br><span class="line">+               ; Symbol - most punctuation allowed</span><br><span class="line">clojure.core/+  ; Namespaced symbol</span><br><span class="line"></span><br><span class="line"><span class="comment">;; Collection types</span></span><br><span class="line">'(1 2 3)     ; list</span><br><span class="line">[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]      <span class="comment">; vector</span></span><br><span class="line">#&#123;1 2 3&#125;     ; set</span><br><span class="line">&#123;<span class="symbol">:a</span> <span class="number">1</span>, <span class="symbol">:b</span> <span class="number">2</span>&#125; <span class="comment">; map</span></span><br></pre></td></tr></table></figure>
<h3 id="结构与语义"><a href="#结构与语义" class="headerlink" title="结构与语义"></a>结构与语义</h3><p>在 Clojure 里面，有一个非 Lisp 语言中没有的 <a href="https://clojure.org/reference/data_structures#Symbols" target="_blank" rel="noopener">Symbol 类型</a>，定义如下：</p>
<blockquote>
<p>Symbols are identifiers that are normally used to refer to something else.</p>
</blockquote>
<p>可以说 symbol 就是一些标识符，用来代指其他东西，和英文中 he/she/it 等「代词」的作用差不多。现在大家所使用的高级语言，其语言构造体（language’s constructs）是由一些关键字与用户自定义变量组成，这些都是 symbol。看下面这个表达式：<br><img src="https://img.alicdn.com/imgextra/i3/581166664/TB2twOcjL6H8KJjSspmXXb2WXXa_!!581166664.png" alt="structure-and-semantics"></p>
<p>上面的绿色字标明这个表达式用到的数据结构，下面蓝色字标明这个表达式在运行时的含义。</p>
<p>大多数字面量进行求值（eval）时，都表示其自身，比如 <code>1</code> 就是数字 1，而 symbol 与 list 这两类则不同，它们在求值时，symbol 返回它所代指的值，list 表示函数调用。Clojure 里面提供了 def 这个<a href="https://clojure.org/reference/special_forms" target="_blank" rel="noopener">special form</a>来建立 symbol 到其他值的映射关系。例如：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user&gt; (<span class="function"><span class="keyword">def</span> <span class="title">cat</span></span> <span class="string">"Tom"</span>)</span><br><span class="line"><span class="comment">#'user/cat</span></span><br></pre></td></tr></table></figure></p>
<p>简单来说上面这一句把 symbol 字面量<code>cat</code>指向了字符串<code>Tom</code>，但是由于 Clojure 里面为了实现其动态特性，真实的情况稍微复杂一些，见下图：<br><img src="https://img.alicdn.com/imgextra/i4/581166664/TB2vBerXioaPuJjSsplXXbg7XXa_!!581166664.png" alt></p>
<p>Var 是Clojure里面提供的<a href="http://clojure-doc.org/articles/language/concurrency_and_parallelism.html#clojure-reference-types" target="_blank" rel="noopener">四种引用类型</a>中最常用的，支持动态作用域以及 thread-local 值。动态作用域是指函数内的自由变量的值是在运行时确定的，这里不清楚的可以参考我的另一篇文章<a href="/blog/2016/05/28/scope-closure/">《编程语言中的变量作用域与闭包》</a>，这里不在赘述。</p>
<p>继续回到上面的图，def 会把 cat 这个 symbol 指向同名的 var，同时把 var 指向字符串 Tom（叫做 root binding）。symbol 到 var 的映射关系保存在每个 namespace 中，可以用<code>resolve</code>来查询这个映射关系：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user&gt; (<span class="name">resolve</span> 'cat)</span><br><span class="line">#'user/cat</span><br></pre></td></tr></table></figure></p>
<p>最后一点需要注意的是，symbol 到 var 的映射关系只有在用 def（或其变体defn/defmacro） 定义时才具有，使用 let, loop 等定义的词法作用域（lexical context）里面的 binding 称为 <a href="https://groups.google.com/forum/#!topic/clojure/FLrtjyYJdRU" target="_blank" rel="noopener">locals</a>，没有这种映射关系，<a href="https://groups.google.com/forum/#!topic/clojure/PCKzXweeDeY" target="_blank" rel="noopener">locals 一旦创建后无法修改</a>。可以使用 <code>with-local-vars</code>（很少用到）宏来定义局部变量：<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">with-local-vars</span> [<span class="name">x</span> <span class="number">1</span> y <span class="number">2</span>]</span><br><span class="line">  (<span class="name">var-set</span> x <span class="number">11</span>)</span><br><span class="line">  (<span class="name"><span class="builtin-name">+</span></span> (<span class="name">var-get</span> x) (<span class="name">var-get</span> y)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; =&gt; 13</span></span><br></pre></td></tr></table></figure></p>
<h2 id="quote"><a href="#quote" class="headerlink" title="quote"></a>quote</h2><p>由上面介绍我们知道，symbol 与 list 这两类字面量在求值时有特殊的处理方式，但在一些时间，不希望进行这种特殊处理，就希望 symbol 返回一个 symbol，list 不在表示函数调用，这时候就可以使用 <code>quote</code>（一般使用简化形式<code>&#39;</code>） 来实现：</p>
<figure class="highlight clojure-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">user=&gt;</span><span class="clojure"> (<span class="name"><span class="builtin-name">quote</span></span> x)</span></span><br><span class="line">x</span><br><span class="line"><span class="meta">user=&gt;</span><span class="clojure"> 'x</span></span><br><span class="line">x</span><br><span class="line"><span class="meta">user=&gt;</span><span class="clojure"> '(<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>)</span></span><br><span class="line">(1 2 3)</span><br></pre></td></tr></table></figure>
<p>一个常见的错误就是误把都是数据的 list 作为 code 去执行了：<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user=&gt; (<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>)</span><br><span class="line">ClassCastException java<span class="built_in">.lang</span>.Long cannot be <span class="keyword">cast</span> <span class="keyword">to</span> clojure<span class="built_in">.lang</span>.IFn</span><br></pre></td></tr></table></figure></p>
<p>quote 在写宏时非常重要，我们这里只需要知道宏传入的参数都是 symbol 字面量即可，实战篇会详细介绍如何使用。下面仅举一例作为说明：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user&gt; (<span class="function"><span class="keyword">def</span> <span class="title">a</span></span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">#'user/a</span></span><br><span class="line">user&gt; (defmacro demo-<span class="function"><span class="keyword">macro</span> [<span class="title">params</span></span>] (println params))</span><br><span class="line"><span class="comment">#'user/demo-macro</span></span><br><span class="line">user&gt; (demo-<span class="function"><span class="keyword">macro</span> <span class="title">a</span></span>)</span><br><span class="line">a</span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到这里打印的是 symbol 字面量 <code>a</code>，而不是数字 1。由于<code>demo-macro</code>什么也没返回，所以在打印出 a 之后输出了 nil。</p>
<h2 id="宏的本质"><a href="#宏的本质" class="headerlink" title="宏的本质"></a>宏的本质</h2><p>由于 Lisp 采用 S-表达式（s-expression）作为其语言的构造体，所以天然具有 code as data 的特点，也就是说 Lisp 程序本身就是一个标准的 Lisp 数据结构，可以像操作其他数据类型一样来操作程序本身，这其实就是宏做的事情。老牌 Lisp hacker <a href="http://www.paulgraham.com" target="_blank" rel="noopener">Paul Graham</a> 在黑客与画家一书中有<a href="/blog/2016/12/31/dev-in-clojure/#Why-Lisp">提到</a>：</p>
<blockquote>
<p>Lisp 并不严格区分读取期、编译器、运行期。在编译期去运行就是宏，可以用来扩展语言。</p>
</blockquote>
<p>关于这三个时期的关系，可以用下面的图来表示<br><img src="https://img.alicdn.com/imgextra/i3/581166664/TB27iCQbiIRMeJjy0FbXXbnqXXa_!!581166664.png" alt="Lisp 中不同时期的交互图"></p>
<p>由于运行期主要进行的是函数的调用，结合上面 symbol 的知识可以这么定义宏</p>
<blockquote>
<p>宏是编译期执行的函数，参数的类型是 symbol，返回值 symbol 数据结构（也是code）。返回值在运行时执行。</p>
</blockquote>
<p>定义宏的<code>defmacro</code>本身也是个宏，可以将其展开：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user&gt; (<span class="name">macroexpand</span> '(defmacro demo-macro [params] params))</span><br><span class="line"></span><br><span class="line">(<span class="name">do</span></span><br><span class="line">  (<span class="name">defn</span> demo-macro ([<span class="symbol">&amp;form</span> <span class="symbol">&amp;env</span> params] params))</span><br><span class="line">  (. #'demo-macro (<span class="name">setMacro</span>))</span><br><span class="line">  #'demo-macro)</span><br></pre></td></tr></table></figure></p>
<p>可以看到，Clojure 里面是调用 <code>setMacro</code> 来将宏与一般的函数分开。</p>
<h2 id="求值过程"><a href="#求值过程" class="headerlink" title="求值过程"></a>求值过程</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>Clojure 语言本身 hosted 在 JVM 上，所以先看下 Java 是如何求值的：</p>
<p><img src="https://img.alicdn.com/imgextra/i4/581166664/TB2vuFjjN6I8KJjSszfXXaZVXXa_!!581166664.png" alt="Java 求值过程"></p>
<p>在 Java 中，源代码（.java 文件）以字符流（characters）的形式被编译器（javac）处理，输出的 .class 文件包含了可以在 JVM 运行的 bytecode。</p>
<h3 id="Clojure"><a href="#Clojure" class="headerlink" title="Clojure"></a>Clojure</h3><p><img src="https://img.alicdn.com/imgextra/i2/581166664/TB25GXJcQfb_uJkHFrdXXX2IVXa_!!581166664.png" alt="Clojure 求值过程"></p>
<p>在 Clojure 中，源代码首先以字符流的形式被 Reader 处理，输出以 Clojure 数据结构表示的 code，之后编译器读入这些数据结构，输出 bytecode。</p>
<p>这里有非常重要的两点：</p>
<ol>
<li>Clojure 的源代码的基本单元是表达式，而不是源文件。这里的源文件可以是存在于磁盘上的 <code>.clj</code> 文件或 REPL。源文件被转化为一系列 表达式 后才被编译器处理</li>
<li>区分 Reader 与 Compiler 这两个过程是「宏」的基础，宏接受 Reader 处理后的code（也是数据），输出供 Compiler 执行的 code（也是数据）</li>
</ol>
<p>具体实现细节可以参考<a href="/blog/2017/02/05/clojure-compiler-analyze/#macroexpand">《Clojure 运行原理之编译器剖析篇》</a>：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/581166664/TB2j7k3dZtnpuFjSZFKXXalFFXa_!!581166664.png" alt="Clojure 编译器工作流程"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于初学 Lisp 的同学，对 symbol 类型不是很清楚，究其原因是这个类型在非 Lisp 语言中是不存在的，为什么不存在呢？主要是因为它们没法像 Lisp 一样具有 code as data 的特点，有些非 Lisp 语言可能也有所谓的 symbol 类型，像 ruby，但是其用法却与 Lisp 完全不同。区别可以参考<a href="https://www.slideshare.net/antoniogarrote/lisp-vs-ruby-metaprogramming-3222908" target="_blank" rel="noopener">下图</a></p>
<p><img src="https://img.alicdn.com/imgextra/i4/581166664/TB2FQO3bnZRMeJjSspoXXcCOFXa_!!581166664.png" alt="Metaprogramming Ruby vs Lisp"></p>
<blockquote>
<p>What makes Lisp macros possible, is so far still unique to Lisp, perhaps because (a) it requires those parens, or something just as bad, and (b) if you add that final increment of power, you can no longer claim to have invented a new language, but only to have designed a new dialect of Lisp ; -)</p>
<blockquote>
<p>Paul Graham 「<a href="http://www.paulgraham.com/diff.html" target="_blank" rel="noopener">What makes Lisp different</a>」</p>
</blockquote>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://clojure.org/guides/learn/syntax#_structure_vs_semantics" target="_blank" rel="noopener">Learn Clojure - Syntax</a></li>
<li><a href="http://blog.cognitect.com/blog/2016/9/15/works-on-my-machine-understanding-var-bindings-and-roots" target="_blank" rel="noopener">WORKS ON MY MACHINE: UNDERSTANDING VAR BINDINGS AND ROOTS</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://liujiacai.net/blog/2017/08/31/master-macro-theory/" data-id="ckcro6ilx004i25ljzsh8pq3g" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aQXLDIAwF0N7/0uk2XZh8SU5nDI9VJnGB5wUVkn5+4vF6G1ffv/969f16zvXzNwwMDIzHMl7LsV5yQu29jst5MDAwDmBcTb3+vJ4nAdy1FgYGBkYS9q0P5cmTGBgYGPcyoiWXq2BgYGBMLrGTVFqy1j/dxTEwMB7IyLPu///5K/UNDAyMRzFexZGHhvn1tbeTP/NgYGBszcgPuDw4W280aaqo7gcDA+MERt76cFfZslowWL8UDAyMcxjr5fPjMvmrPKFWDTExMDD2Y/Q23fu1Gg4WAlAMDIytGXnAlyfL5tfg3h4wMDB2ZSSXxvlxPG8a+zAPBgbG1ozyo8XDMTlqqyHg5T4xMDA2ZczTXnmKbVIujdJtGBgYmzJ6wVxvFP4D9O7iGBgYBzCiJtFxIFg9oEcdIhgYGFswqs1bvULjvP2i2WyBgYGxBSMP0XotF99L5GFgYJzDyI/RPA3XayCrljwxMDDOYfTCwWqCLH++d9xjYGCcwMi3nodxeVNFtVz6oWcEAwPjAMakVJAEhdX2r0KZEwMD4xjGpHg5KQlUZy6EhhgYGA9nvIojfzf55m4oKmBgYGzNqF5Qq0Fh76hdh5ijyzYGBsZjGXl5Mi8YzAsMzZoGBgbG1owk0V99vkrtXY8xMDAwkmNxXracN3NgYGBgzNNh9x6yl5dYDAyMrRnJJTa/1vbCxF7aDgMD4wTG5OrYa6G4qyyKgYFxAOMXl14D8V6+UE0AAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Clojure/">Clojure</a></div><div class="post-nav"><a class="pre" href="/blog/2017/10/01/macro-in-action/">由浅入深学习 Lisp 宏之实战篇</a><a class="next" href="/blog/2017/05/11/review-of-secret-of-silicon-valley/">《硅谷之谜》读后感</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://liujiacai.net/blog/2017/08/31/master-macro-theory/';
    this.page.identifier = 'blog/2017/08/31/master-macro-theory/';
    this.page.title = '由浅入深学习 Lisp 宏之理论篇';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//jiacai2050.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//jiacai2050.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://jiacai2050.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://liujiacai.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reproduce/">他山之石</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">大数据</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/search-engine/">搜索引擎</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">热爱生活</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/aha-computer/">理解计算机</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/研习经典/">研习经典</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/langs/">编程语言</a><span class="category-list-count">25</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/music/" style="font-size: 15px;">music</a> <a href="/tags/GEB/" style="font-size: 15px;">GEB</a> <a href="/tags/mooc/" style="font-size: 15px;">mooc</a> <a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/algorithm/" style="font-size: 15px;">算法</a> <a href="/tags/lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/lisp/" style="font-size: 15px;">Lisp</a> <a href="/tags/mozilla/" style="font-size: 15px;">mozilla</a> <a href="/tags/best-practice/" style="font-size: 15px;">最佳实践</a> <a href="/tags/linux/" style="font-size: 15px;">Linux</a> <a href="/tags/javascript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/sicp/" style="font-size: 15px;">sicp</a> <a href="/tags/scheme/" style="font-size: 15px;">Scheme</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/python/" style="font-size: 15px;">Python</a> <a href="/tags/ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Clojure/" style="font-size: 15px;">Clojure</a> <a href="/tags/gc/" style="font-size: 15px;">GC</a> <a href="/tags/ideas/" style="font-size: 15px;">ideas</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2020/03/14/go-struct-interface/">Go struct/interface 最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/02/review-2019/">2019 年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/10/24/go-modules/">何处安放我们的 Go 代码</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/07/17/hello-golang/">写给新手的 Go 开发指南</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/21/experience-in-clojure/">Clojure 开发经验总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/09/java-gc-definitive-guide/">Java 垃圾回收权威指北</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/29/how-java-synchronizer-work/">Java 线程同步原理探析</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/10/damn-single-socket/">形单影只的 Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/18/generational-gc/">深入浅出垃圾回收（四）分代式 GC</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/04/incremental-gc/">深入浅出垃圾回收（三）增量式 GC</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//jiacai2050.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Keep Coding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>