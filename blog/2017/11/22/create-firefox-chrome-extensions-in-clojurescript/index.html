<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Do have faith in what you are doing."><title>使用 ClojureScript 开发浏览器插件的过程与收获 | Keep Coding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-50745138-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '3ffc15f400ce3f8b1db5afc4f29b6ce9';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用 ClojureScript 开发浏览器插件的过程与收获</h1><a id="logo" href="/.">Keep Coding</a><p class="description">Stay hungry, Stay foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/blogrolls/"><i class="fa fa-group"> 友情链接</i></a><a href="/podcast/"><i class="fa fa-podcast"> Podcast</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用 ClojureScript 开发浏览器插件的过程与收获</h1><div class="post-meta">Nov 22, 2017<span> | </span><span class="category"><a href="/categories/langs/">编程语言</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 3.6k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 14</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" data-disqus-identifier="blog/2017/11/22/create-firefox-chrome-extensions-in-clojurescript/" href="/blog/2017/11/22/create-firefox-chrome-extensions-in-clojurescript/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ClojureScript-工作机制"><span class="toc-number">1.</span> <span class="toc-text">ClojureScript 工作机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Closure-compiler"><span class="toc-number">1.1.</span> <span class="toc-text">Closure compiler</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发环境准备"><span class="toc-number">2.</span> <span class="toc-text">开发环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#消除-inline"><span class="toc-number">2.1.</span> <span class="toc-text">消除 inline</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#background-script"><span class="toc-number">2.1.1.</span> <span class="toc-text">background script</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#option-popup"><span class="toc-number">2.1.2.</span> <span class="toc-text">option/popup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#content-script"><span class="toc-number">2.1.3.</span> <span class="toc-text">content script</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区分-dev-与-release-模式"><span class="toc-number">2.2.</span> <span class="toc-text">区分 dev 与 release 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#externs"><span class="toc-number">2.3.</span> <span class="toc-text">externs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试环境"><span class="toc-number">2.4.</span> <span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#re-agent"><span class="toc-number">2.5.</span> <span class="toc-text">re-agent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#坑"><span class="toc-number">3.</span> <span class="toc-text">坑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#宏"><span class="toc-number">3.1.</span> <span class="toc-text">宏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JS-interop"><span class="toc-number">3.2.</span> <span class="toc-text">JS interop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDE"><span class="toc-number">3.3.</span> <span class="toc-text">IDE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><p>随着 Firefox 57 的到来，之前维护的一个浏览器插件 <a href="https://github.com/jiacai2050/gooreplacer" target="_blank" rel="noopener">gooreplacer</a> 必须升级到 WebExtensions 才能继续使用，看了下之前写的 JS 代码，毫无修改的冲动，怕改了这个地方，那个地方突然就 broken 了。因此，这次选择了 cljs，整体下来流程很顺利，除了迁移之前的功能，又加了更多功能，希望能成为最简单易用的重定向插件 :-)</p>
<p>闲话少说，下面的内容依次会介绍 cljs 的工作机制、开发环境，如何让 cljs 适配浏览器插件规范，以及重写 gooreplacer 时的一些经验。<br>本文的读者需要对 Clojure 语言、浏览器插件开发一般流程有基本了解，并且完成 ClojureScript 的 <a href="https://clojurescript.org/guides/quick-start" target="_blank" rel="noopener">Quick Start</a>。对于 Clojure，我目前在 sf 上有<a href="https://github.com/jiacai2050/learn_clojure.mp4" target="_blank" rel="noopener">一套视频课程</a>，供参考。</p>
<p>为了方便大家使用 cljs 开发插件，我整理了<a href="https://github.com/jiacai2050/browser-extenstion.cljs" target="_blank" rel="noopener">一份模板</a>，供大家参考。gooreplacer 完整代码在<a href="https://github.com/jiacai2050/gooreplacer" target="_blank" rel="noopener">这里</a>，技术栈为  cljs + reagent + antd。我的另一个项目 <a href="https://github.com/jiacai2050/history-master" target="_blank" rel="noopener">History Master</a> 在最近也用 cljs 重写了，技术栈相比 gooreplacer 增加了 <a href="https://github.com/Day8/re-frame" target="_blank" rel="noopener">re-frame</a>。</p>
<h2 id="ClojureScript-工作机制"><a href="#ClojureScript-工作机制" class="headerlink" title="ClojureScript 工作机制"></a>ClojureScript 工作机制</h2><p>ClojureScript 是使用 Clojure 编写，最终编译生成 JS 代码的一个<a href="http://blog.fogus.me/2012/04/25/the-clojurescript-compilation-pipeline/" target="_blank" rel="noopener">编译器</a>，在编译过程中使用 <a href="https://github.com/google/closure-compiler" target="_blank" rel="noopener">Google Closure Compiler</a> 来优化 JS 代码、解决<a href="https://github.com/google/closure-compiler/wiki/Managing-Dependencies" target="_blank" rel="noopener">模块化引用</a>的问题。整体工作流程如下：</p>
<p><img src="/images/clojure/cljs_compile.png" alt="cljs 编译流程"></p>
<p>Cljs 还提供 <a href="http://cljs.info/cheatsheet/" target="_blank" rel="noopener">与原生 JS 的交互</a>、<a href="https://clojurescript.org/reference/javascript-module-support" target="_blank" rel="noopener">集成</a><a href="https://clojurescript.org/news/2017-07-12-clojurescript-is-not-an-island-integrating-node-modules" target="_blank" rel="noopener">第三方类库</a>的支持，所以，只要能用 JS 的地方，都能用 cljs。</p>
<h3 id="Closure-compiler"><a href="#Closure-compiler" class="headerlink" title="Closure compiler"></a>Closure compiler</h3><p>这里需要着重介绍一下 Google 的这个项目，可以在不运行代码的前提下分析代码逻辑，去掉没有使用到的代码，这对于 cljs 是非常重要的。一个项目中不可能使用到 cljs 中所有的函数，如果不进行代码“减肥”，最终编译出来 JS 文件就会超大，根本没法在浏览器中使用。<br>奇怪的是功能这么强大的项目却鲜为人知，不得不说 Google 在“推销”这方面还需要向 Facebook 学习。有一个在线地址，供大家体验 Closure 的强大：</p>
<ul>
<li><a href="https://closure-compiler.appspot.com" target="_blank" rel="noopener">https://closure-compiler.appspot.com</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Hello, '</span> + name);</span><br><span class="line">&#125;</span><br><span class="line">hello(<span class="string">'New user'</span>);</span><br></pre></td></tr></table></figure>
<p>在优化策略为 advanced 时最终生成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">"Hello, New user"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h2><p>开发 cljs 的环境首选 <a href="https://github.com/technomancy/leiningen#installation" target="_blank" rel="noopener">lein</a> + <a href="https://github.com/bhauman/lein-figwheel" target="_blank" rel="noopener">figwheel</a>，figwheel 相比 <a href="https://github.com/emezeske/lein-cljsbuild" target="_blank" rel="noopener">lein-cljsbuild</a> 提供了热加载的功能，这一点对于开发 UI 很重要！</p>
<p>对于一般的 cljs 应用，基本都是用一个 script 标签去引用编译后的 js 文件，然后这个 js 文件再去加载其他依赖。比如：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/main.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>js/main.js 是 project.clj 里面指定的输出文件，它会去加载其他所需文件，其内容大致如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CLOSURE_UNCOMPILED_DEFINES = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> CLOSURE_NO_DEPS = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> goog == <span class="string">"undefined"</span>) <span class="built_in">document</span>.write(<span class="string">'&lt;script src="js/out/goog/base.js"&gt;&lt;/script&gt;'</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;script src="js/out/goog/deps.js"&gt;&lt;/script&gt;'</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;script src="js/out/cljs_deps.js"&gt;&lt;/script&gt;'</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;script&gt;if (typeof goog == "undefined") console.warn("ClojureScript could not load :main, did you forget to specify :asset-path?");&lt;/script&gt;'</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;script&gt;goog.require("process.env");&lt;/script&gt;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"&lt;script&gt;if (typeof goog != \"undefined\") &#123; goog.require(\"figwheel.connect.build_dev\"); &#125;&lt;/script&gt;"</span>);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">'&lt;script&gt;goog.require("hello_world.core");&lt;/script&gt;'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="消除-inline"><a href="#消除-inline" class="headerlink" title="消除 inline"></a>消除 inline</h3><h4 id="background-script"><a href="#background-script" class="headerlink" title="background script"></a>background script</h4><p>对于一般的 Web 项目，只引用这一个 js 文件就够了，但是对于浏览器插件来说，有一些问题，浏览器插件出于安全因素考虑，是<a href="https://developer.chrome.com/extensions/contentSecurityPolicy#relaxing-inline-script" target="_blank" rel="noopener">不让执行 incline script</a>，会报如下错误</p>
<p><img src="https://img.alicdn.com/imgextra/i1/581166664/TB2xXZVeJnJ8KJjSszdXXaxuFXa_!!581166664.png" alt="inline script error"></p>
<p>为了去掉这些错误，手动加载 js/main.js 里面动态引入的文件，require 所需命名空间即可，修改后的 html 如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/out/goog/base.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/out/cljs_deps.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/init.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中 init.js 内容为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// figwheel 用于热加载，这里的 build_dev 其实是 build_&#123;build_id&#125;，默认是 dev</span></span><br><span class="line">goog.require(<span class="string">"figwheel.connect.build_dev"</span>);</span><br><span class="line"><span class="comment">// 加载为 main 的命名空间</span></span><br><span class="line">goog.require(<span class="string">"hello_world.core"</span>);</span><br></pre></td></tr></table></figure>
<p>这样就可以正常在浏览器插件环境中运行了。可以在 DevTools 中观察到所有引用的 js 文件</p>
<p><img src="https://img.alicdn.com/imgextra/i2/581166664/TB2buKhe3vD8KJjSsplXXaIEFXa_!!581166664.png" alt="动态加载的 JS 文件"> </p>
<p>在左下角可以看到，总共有 92 个文件。</p>
<h4 id="option-popup"><a href="#option-popup" class="headerlink" title="option/popup"></a>option/popup</h4><p>上述方案对于没有 UI 的 background script 时合适的，但是对于 option 与 popup 页面来说，需要做一点小修改：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/out/goog/base.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/out/cljs_deps.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CLJS demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"init.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>由于我们采用 React 开发，所以一般需要在 html 页面中放一个 id 为 app 的 div，之后的逻辑都围绕这个 div 进行，所以只需要把 init.js 放在这个 div 之后就可以了。</p>
<h4 id="content-script"><a href="#content-script" class="headerlink" title="content script"></a>content script</h4><p>最后比较复杂的是 content script，他与上述两类脚本不一样，没法指定 js 脚本加载顺序，可以想到的一种方式是：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"content_scripts"</span>: [&#123;</span><br><span class="line">  <span class="string">"matches"</span>: [<span class="string">"http://*/*"</span>, <span class="string">"https://*/*"</span>],</span><br><span class="line">  <span class="string">"run_at"</span>: <span class="string">"document_end"</span>,</span><br><span class="line">  <span class="string">"js"</span>: [<span class="string">"content/js/out/goog/base.js"</span>, <span class="string">"content/js/out/cljs_deps.js"</span>, <span class="string">"content/init.js"</span>]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>这里的 content 的目录与 manifest.json 在同一级目录。采用这种方式会报如下的错误</p>
<p><img src="https://img.alicdn.com/imgextra/i2/581166664/TB2vEaHbBLN8KJjSZPhXXc.spXa_!!581166664.png" alt="content script 报错"></p>
<p>根据错误提示，可以看出是 base.js 再去动态引用其他 js 文件时，是以访问网站为相对路径开始的，因此也就找不到正确的 JS 文件了。</p>
<p>解决方法是设置 cljsbuild 的 <code>optimizations</code> 为 <code>:whitespace</code>，把所有文件打包到一个文件，然后引用这一个就可以了，<a href="https://github.com/binaryage/chromex-sample/issues/2" target="_blank" rel="noopener">这个方法不是很完美</a>，采用 whitespace 一方面使编译时间更长，在我机器上需要12s；另一方面是无法使用 figwheel，会报 A Figwheel build must have :compiler &gt; :optimizations default to nil or set to :none 的错误，因此也就无法使用代码热加载的功能。</p>
<p>gooreplacer 里面只使用了 background page 与 option page，所以这个问题也就避免了。</p>
<h3 id="区分-dev-与-release-模式"><a href="#区分-dev-与-release-模式" class="headerlink" title="区分 dev 与 release 模式"></a>区分 dev 与 release 模式</h3><p>这里的 dev 是指正常的开发流程，release 是指开发完成，准备打包上传到应用商店的过程。</p>
<p>在 dev 过程中，推荐设置 cljsbuild 的 <code>optimizations</code> 为 none，以便得到最快的编译速度；<br>在 release 过程中，可以将其设置为 <code>advanced</code>，来压缩、优化 js 文件，以便最终的体积最小。</p>
<p>为了在两种模式中复用使用的图片、css 等资源，可采用了软链的来实现，resources 目录结构如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── css</span><br><span class="line">│   └── option.css</span><br><span class="line">├── dev</span><br><span class="line">│   ├── <span class="attribute">background</span></span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   │   └── init.js</span><br><span class="line">│   ├── <span class="attribute">content</span></span><br><span class="line">│   ├── manifest<span class="selector-class">.json</span> -&gt; ../manifest.json</span><br><span class="line">│   └── option</span><br><span class="line">│       ├── css -&gt; ../../css/</span><br><span class="line">│       ├── images -&gt; ../../images/</span><br><span class="line">│       ├── index.html</span><br><span class="line">│       └── init.js</span><br><span class="line">├── images</span><br><span class="line">│   ├── cljs.png</span><br><span class="line">│   ├── cljs_16.png</span><br><span class="line">│   ├── cljs_32.png</span><br><span class="line">│   └── cljs_48.png</span><br><span class="line">├── manifest.json</span><br><span class="line">└── release</span><br><span class="line">    ├── <span class="attribute">background</span></span><br><span class="line">    │   ├── index.html</span><br><span class="line">    │   └── js</span><br><span class="line">    │       └── main.js</span><br><span class="line">    ├── <span class="attribute">content</span></span><br><span class="line">    │   └── js</span><br><span class="line">    │       └── main.js</span><br><span class="line">    ├── manifest<span class="selector-class">.json</span> -&gt; ../manifest.json</span><br><span class="line">    └── option</span><br><span class="line">        ├── css -&gt; ../../css/</span><br><span class="line">        ├── images -&gt; ../../images/</span><br><span class="line">        ├── index.html</span><br><span class="line">        └── js</span><br><span class="line">            └── main.js</span><br></pre></td></tr></table></figure>
<p>其次，为了方便开启多个 figwheel 实例来分别编译 background、option 里面的 js，定义了多个 lein 的 profiles，来指定不同环境下的配置，具体可参考 <a href="https://github.com/jiacai2050/browser-extenstion.cljs/blob/master/project.clj#L13" target="_blank" rel="noopener">模板的 project.clj</a> 文件。</p>
<h3 id="externs"><a href="#externs" class="headerlink" title="externs"></a>externs</h3><p>在 optimizations 为 advanced 时，cljs 会充分借用 Google Closure Compiler 来压缩、混淆代码，会把变量名重命名为 a b c 之类的简写，为了不使 chrome/firefox 插件 API 里面的函数混淆，需要加载它们对应的 externs 文件，一般只需要这两个 <a href="https://github.com/google/closure-compiler/blob/master/contrib/externs/chrome_extensions.js" target="_blank" rel="noopener">chrome_extensions.js</a>、<a href="https://github.com/google/closure-compiler/blob/master/contrib/externs/chrome.js" target="_blank" rel="noopener">chrome.js</a>，如果项目中用到了其他的库，extern 文件的生成方式可以参考<a href="https://github.com/google/closure-compiler/wiki/Externs-For-Common-Libraries" target="_blank" rel="noopener">Externs For Common Libraries
</a>。</p>
<h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p>cljs 自带的 test 功能比较搓，比较好用的是 <a href="https://github.com/bensu/doo" target="_blank" rel="noopener">doo</a>，为了使用它，需要先提前安装 <a href="http://phantomjs.org/" target="_blank" rel="noopener">phantom</a> 来提供 headless 环境，写好测试就可以执行了：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">lein doo phantom </span><span class="template-variable">&#123;build-id&#125;</span><span class="xml"> </span><span class="template-variable">&#123;watch-mode&#125;</span></span><br></pre></td></tr></table></figure>
<p>非常棒的一点是它也能支持热加载，所以在开发过程中我一直开着它。</p>
<h3 id="re-agent"><a href="#re-agent" class="headerlink" title="re-agent"></a>re-agent</h3><p><a href="http://reagent-project.github.io/" target="_blank" rel="noopener">re-agent</a> 是对 React 的一个封装，使之符合 cljs 开发习惯。毫无夸张的说，对于非专业前端程序员来说，要想使用 React，cljs 比 jsx 是个更好的选择，<a href="https://github.com/weavejester/hiccup" target="_blank" rel="noopener">Hiccup-like</a> 的语法比 jsx 更紧凑，不用再去理睬 <a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack</a>，<a href="https://babeljs.io/" target="_blank" rel="noopener">babel</a> 等等层出不穷的 js 工具，更重要的一点是 immutable 在 cljs 中无处不在，re-agent 里面有自己维护状态的机制 atom，不在需要严格区分 React 里面的 props 与 state。</p>
<p>了解 re-agent 的最好方式就是从它<a href="http://reagent-project.github.io/" target="_blank" rel="noopener">官网给出的示例</a>开始，然后阅读 re-frame wiki 里面的 <a href="https://github.com/Day8/re-frame/wiki/Creating-Reagent-Components" target="_blank" rel="noopener">Creating Reagent Components</a>，了解三种不同的 form 的区别，98% gooreplacer 都在使用 form-2。如果对原理感兴趣，建议也把其他 wiki 看完。</p>
<p>re-agent 还有一点比较实用，提供了对 React 原生组件的转化函数：<a href="http://nicolovaligi.com/boostrap-components-reagent-clojurescript.html" target="_blank" rel="noopener">adapt-react-class</a>，使用非常简单：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">def</span></span> Button (<span class="name">reagent/adapt-react-class</span> (<span class="name">.-Button</span> js/ReactBootstrap)))</span><br><span class="line"></span><br><span class="line">[<span class="symbol">:div</span></span><br><span class="line">  [<span class="symbol">:h2</span> <span class="string">"A sample title"</span>]</span><br><span class="line">  [Button <span class="string">"with a button"</span>]]</span><br></pre></td></tr></table></figure>
<p>此外对于原生的 JS 库比如 <a href="http://echarts.baidu.com/" target="_blank" rel="noopener">echarts</a>，也可以采用 <a href="http://timothypratley.blogspot.hk/2017/01/reagent-deep-dive-part-2-lifecycle-of.html" target="_blank" rel="noopener">form3 的方式使用</a>。可以看看 <a href="https://github.com/jiacai2050/history-master/blob/6ed01d28d68ed1d6b7a95cc3229e2cbcb9748d6a/cljs-src/src/option/history_master/stat.cljs#L12-L49" target="_blank" rel="noopener">History Master 是如何使用</a>的，这里有一些有<a href="https://www.reddit.com/r/Clojure/comments/7oz1ak/reagent_deep_dive_part_2_the_lifecycle_of_a/" target="_blank" rel="noopener">价值的讨论</a>供参考。</p>
<p>说到 re-agent，就不能不提到 <a href="https://github.com/omcljs/om/wiki/Quick-Start-%28om.next%29" target="_blank" rel="noopener">om.next</a>，这两个在 cljs 社区里面应该是最有名的 React wrapper，om.next 理念与使用难度均远高于 re-agent，初学者一般不推荐直接用 om.next。感兴趣的可以看看这两者之间的比较：</p>
<ul>
<li><a href="https://purelyfunctional.tv/article/why-re-frame-instead-of-om-next/" target="_blank" rel="noopener">Why Re-frame instead of Om Next</a>，以及 <a href="https://www.reddit.com/r/Clojure/comments/6q0jhn/why_reframe_instead_of_om_next/" target="_blank" rel="noopener">Reddit 上的讨论</a></li>
<li><a href="https://www.reddit.com/r/Clojure/comments/3vk58p/a_rant_on_om_next/" target="_blank" rel="noopener">A rant on Om Next</a></li>
</ul>
<h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><h3 id="宏"><a href="#宏" class="headerlink" title="宏"></a><a href="https://clojurescript.org/about/differences#_macros" target="_blank" rel="noopener">宏</a></h3><p>cljs 里面加载宏的机制有别于 Clojure，一般需要单独把宏定义在一个文件里面，然后在 cljs 里面用<code>(:require-macros [my.macros :as my])</code> 这样的方式去引用，而且宏定义的文件名后缀必须是 clj 或 cljc，不能是 cljs，这一点坑了我好久。。。</p>
<p>由于宏编译与 cljs 编程在不同的时期，所以如果宏写错了，就需要把 repl 杀掉重启来把新的宏 feed 给 cljs，这点也比较痛苦，因为 repl 的启动速度实在是有些慢。这一点在 Clojure 里面虽然也存在，但是 Clojure 里面一般 repl 开了就不关了，直到电脑重启。</p>
<p><img src="https://img.alicdn.com/imgextra/i1/581166664/TB2iGyXbvjM8KJjSZFyXXXdzVXa_!!581166664.png" alt="我机器上启动的 repl 列表"></p>
<h3 id="JS-interop"><a href="#JS-interop" class="headerlink" title="JS interop"></a>JS interop</h3><p>与 Clojure 类似， cljs 提供了很便利的方式与 JS 交互，但是社区内有一点误用，就是访问、设置一个 JS 对象的属性，网上<a href="http://clojurescriptmadeeasy.com/blog/js-interop-property-access.html" target="_blank" rel="noopener">很多地方</a>推荐使用 aset aget，但是这是一个误用，这两个方法中的 a 表示的是 array，只是用来访问数组的，由于这个误用非常广泛，cljs 官网还专为其<a href="https://clojurescript.org/news/2017-07-14-checked-array-access" target="_blank" rel="noopener">发了一篇博客</a>。正确的方式是用 goog.object 或者 <a href="https://github.com/binaryage/cljs-oops" target="_blank" rel="noopener">cljs-oops</a>。示例代码：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;;instead of aget</span></span><br><span class="line">(<span class="name">require</span> 'goog.object)</span><br><span class="line">(<span class="name">def</span> obj #js &#123;<span class="symbol">:foo</span> #js &#123;<span class="symbol">:bar</span> <span class="number">2</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line">(<span class="name">goog</span>.object/get obj <span class="string">"foo"</span>)</span><br><span class="line"><span class="comment">;;=&gt; #js &#123;:bar 2&#125; </span></span><br><span class="line"></span><br><span class="line">(<span class="name">goog</span>.object/getValueByKeys obj <span class="string">"foo"</span> <span class="string">"bar"</span>)</span><br><span class="line"><span class="comment">;;=&gt; 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;;instead of aset</span></span><br><span class="line">(<span class="name">def</span> obj #js &#123;<span class="symbol">:foo</span> <span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line">(<span class="name">goog</span>.object/set obj <span class="string">"foo"</span> <span class="string">"bar"</span>)</span><br><span class="line">obj</span><br><span class="line"><span class="comment">;;=&gt; #js &#123;:foo "bar"&#125;</span></span><br></pre></td></tr></table></figure>
<p>其实我们需要的大部分 dom 操作都可以在 <a href="https://github.com/google/closure-library" target="_blank" rel="noopener">Google closure library</a> 找到，而且其代码质量也比较高，所以熟练掌握其 <a href="https://google.github.io/closure-library/api/" target="_blank" rel="noopener">API</a> 也是很有必要的。</p>
<p>写到这里，还有一点我想强调的是，cljs 一些项目是对 JS 的 wrapper，比如我用到的 reagent 就是 React 的一个 wrapper，这就很有可能你需要的功能没在它的说明文档里面，虽然 JS 库里面有，但是你却不知道如何在 cljs 去调用，另一个比较类似的问题是根据文档去操作，遇到了很奇怪的问题，比如应该输出 A，却输出了 B，这时就需要去社区寻求帮助，一般来说都可以在一两天内得到解决，但是也不排除没有解决的情况，我自己就遇到一两个这样的例子，这时就只能去看源代码，这点其实与 Clojure 比较像，比较 Lisp 是个小众语言，所以不建议初学者把一些重要的项目用 cljs 重写，不过对于一些自己个人项目，我鼓励用 cljs 改写，可以学到很多东西，我再使用 reframe 时，了解到了 React <a href="https://reactjs.org/docs/react-component.html" target="_blank" rel="noopener">组件生命周期</a>的过程，Reagent 何时会<a href="https://github.com/Day8/re-frame/wiki/When-do-components-update%3F" target="_blank" rel="noopener">触发 component 的更新</a>，这都是很宝贵的经验。</p>
<h3 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h3><p>Clojure 里面采用 Emacs + Cider 的开发环境非常完美，但是到了 cljs 里面，开发流程没有那么平滑，总是有些磕磕绊绊，也给 cider <a href="https://github.com/clojure-emacs/cider/issues/2099" target="_blank" rel="noopener">提了个 issue</a>，貌似一直没人理，支持确实不好，不过有了 figwheel，在一定程度上能弥补这个缺陷。在 Emacs 里面配置 repl 可参考：</p>
<ul>
<li><a href="https://cider.readthedocs.io/en/latest/up_and_running/#clojurescript-usage" target="_blank" rel="noopener">https://cider.readthedocs.io/en/latest/up_and_running/#clojurescript-usage</a></li>
</ul>
<p>Cider 默认会使用 rhino 作为 repl 求值环境，这个在开发浏览器插件时功能很有限，但是对于查看函数定义还是可以的，不过对于真正的项目，还是建议配置成 figwheel repl，可参考：</p>
<ul>
<li><a href="https://github.com/bhauman/lein-figwheel/wiki/Using-the-Figwheel-REPL-within-NRepl" target="_blank" rel="noopener">Using-the-Figwheel-REPL-within-NRepl</a></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到了 2018 年，如果让我列举 Clojure 里面的一个<a href="https://www.reddit.com/r/Clojure/comments/75apb2/does_clojure_have_a_killer_app/" target="_blank" rel="noopener">杀手级</a><a href="https://groups.google.com/forum/#!topic/clojure/YCnG3rmOp5w" target="_blank" rel="noopener">应用</a>，我觉得会是 ClojureScript。<br>ClojureScript 项目的 leader swannodette 在<a href="https://swannodette.github.io" target="_blank" rel="noopener">其博客</a>里描述了自 cljs 诞生一来的开发历程，通过阅读里面的大部分文章，我感受到 cljs 社区的强大，不断有让人眼前一亮的项目，从 <a href="https://github.com/bhauman/lein-figwheel" target="_blank" rel="noopener">figwheel</a> 到 <a href="https://github.com/bhauman/devcards" target="_blank" rel="noopener">devcards</a>，从 <a href="https://github.com/reagent-project/reagent" target="_blank" rel="noopener">re-agent</a> 到 <a href="https://github.com/Day8/re-frame" target="_blank" rel="noopener">re-frame</a>，从<a href="https://swannodette.github.io/2015/07/29/clojurescript-17" target="_blank" rel="noopener">自编译的 cljs</a> 到 <a href="https://github.com/mfikes/Planck" target="_blank" rel="noopener">Planck</a> 与 <a href="https://github.com/mfikes/replete" target="_blank" rel="noopener">Replete</a>，当然还有 <a href="https://shaunlebron.github.io/parinfer/" target="_blank" rel="noopener">parinfer</a>，他给初学者提供了一种全新的方式学习 Lisp。</p>
<p>当我看到 swannodette 也是在<a href="https://swannodette.github.io/2015/07/29/clojurescript-17" target="_blank" rel="noopener">受 SICP 的影响</a>后开始了其 Lisp 道路后，我深深感到自己内功的不足，需要更加努力，Keep Coding.</p>
<p>JS 社区里面层出不穷的框架每次都让跃跃欲试的我望而却步，有了 cljs，算是把 Lisp 延伸到了更宽广的“领土”。最近看到这么一句话，与大家分享：</p>
<blockquote>
<p>也许 Lisp 不是解决所有问题最合适的语言，但是它鼓励你设计一种最合适的语言来解决这个难题。</p>
</blockquote>
<p>出处忘记了，大体是这么个意思。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://blog.fogus.me/2012/04/25/the-clojurescript-compilation-pipeline/" target="_blank" rel="noopener">The ClojureScript Compilation Pipeline</a></li>
<li><a href="https://nvbn.github.io/2014/12/07/chrome-extension-clojurescript/" target="_blank" rel="noopener">Chrome extension in ClojureScript</a></li>
<li><a href="https://github.com/binaryage/chromex-sample" target="_blank" rel="noopener">https://github.com/binaryage/chromex-sample</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://liujiacai.net/blog/2017/11/22/create-firefox-chrome-extensions-in-clojurescript/" data-id="ckcro6im5005425lj3g7g6etw" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADNUlEQVR42u3aQXLbMBAEQP//08oDHJEzWKYiQM2Ty5YINHzYwuz+/MTP69fz7q/Xv3n35usV197wwIONjY29Cft1+Vx/5t3C10dzfUDX+8zfdv2vwsbGxj6PnSzTkhJAAkuodZHDxsbG/np2fvG4Po7r4tdSsbGxsbHbApZfVyY5T1vksLGxsb+TvRYbJUvOy9h/ztKwsbGxP56dl5bP//mf9LexsbGxP5j9Kp+1QtW2DdohnlqBjY2NfRA7LwCj+GYQBj0VXWFjY2Ofzc4D+paUY/LV2wN6oC+BjY2NvQl7UhjaQKr9zVpBHfVGsLGxsTdht19ro5y2qFyP6SS7re9e2NjY2Juz1xq9zwY98/bzPPDCxsbG3p09b9zmRWstMGrfH8Vb2NjY2Mex22h+beFJ0WoLVTSyg42Njb05e3RaMSzH5zHW6IqCjY2NfRy7je/ba8y8mK2NDT1QCbGxsbG3Zeex+1qreC2cWjugm7sXNjY29hHshNE2btvxnWevKzc6bGxs7IPYk+brpA3cDtzkQVVxWcLGxsY+gp1/tI112vfnpDxUuqnb2NjY2Eew1zaRx0lJIVwbDMrffFO3sbGxsTdnr43CrI3XTMZ62qbFzRFgY2NjH81uN7oWGz0Fbt+wuCQ2Njb2huy8MZAv3zZ08/Zzuy42Njb2SexJJLTWGG6vN+3b6mgJGxsb+yB221JtR3DyYjkfEooOERsbG/sIdh4Y5ReSSZN4Ld6q34mNjY19HDvHtIC1yGmyYpGlYWNjYx/Bztuu81ZrC2svJO3QJzY2NvZJ7LyQPHCucYyVj+DkeysavdjY2NgbsudDNvUFII6EkgtSHmlhY2Njn8p+ahQmv5C0IdRkt3/5LjY2NvYR7Ff55MWpvZbkR5Mf0M3/GRsbG/sI9rxcjUZn4k3nV5HJgBE2Njb2vuw8rF8Lm9oAKN9VG4ot9iiwsbGxN2G3hSFv9K4N8UwKVfR5bGxs7C9mT64N+Wfy8crk2hNNKmFjY2N/DbvdxFrk9NTBvT1EbGxs7OPYSai0NqCZN2Lz7+bh0dtvYWNjYx/Ezhu9eXlox4DaK0feNmgb1djY2Nhbsf8AASvEcKg6d3oAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Clojure/">Clojure</a></div><div class="post-nav"><a class="pre" href="/blog/2018/01/21/review-2017/">2017 年终总结</a><a class="next" href="/blog/2017/10/01/macro-in-action/">由浅入深学习 Lisp 宏之实战篇</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://liujiacai.net/blog/2017/11/22/create-firefox-chrome-extensions-in-clojurescript/';
    this.page.identifier = 'blog/2017/11/22/create-firefox-chrome-extensions-in-clojurescript/';
    this.page.title = '使用 ClojureScript 开发浏览器插件的过程与收获';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//jiacai2050.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//jiacai2050.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://jiacai2050.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://liujiacai.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reproduce/">他山之石</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">大数据</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/search-engine/">搜索引擎</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">热爱生活</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/aha-computer/">理解计算机</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/研习经典/">研习经典</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/langs/">编程语言</a><span class="category-list-count">25</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/music/" style="font-size: 15px;">music</a> <a href="/tags/GEB/" style="font-size: 15px;">GEB</a> <a href="/tags/mooc/" style="font-size: 15px;">mooc</a> <a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/algorithm/" style="font-size: 15px;">算法</a> <a href="/tags/lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/lisp/" style="font-size: 15px;">Lisp</a> <a href="/tags/mozilla/" style="font-size: 15px;">mozilla</a> <a href="/tags/best-practice/" style="font-size: 15px;">最佳实践</a> <a href="/tags/linux/" style="font-size: 15px;">Linux</a> <a href="/tags/javascript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/sicp/" style="font-size: 15px;">sicp</a> <a href="/tags/scheme/" style="font-size: 15px;">Scheme</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/python/" style="font-size: 15px;">Python</a> <a href="/tags/ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Clojure/" style="font-size: 15px;">Clojure</a> <a href="/tags/gc/" style="font-size: 15px;">GC</a> <a href="/tags/ideas/" style="font-size: 15px;">ideas</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2020/03/14/go-struct-interface/">Go struct/interface 最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/02/review-2019/">2019 年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/10/24/go-modules/">何处安放我们的 Go 代码</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/07/17/hello-golang/">写给新手的 Go 开发指南</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/21/experience-in-clojure/">Clojure 开发经验总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/09/java-gc-definitive-guide/">Java 垃圾回收权威指北</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/29/how-java-synchronizer-work/">Java 线程同步原理探析</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/10/damn-single-socket/">形单影只的 Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/18/generational-gc/">深入浅出垃圾回收（四）分代式 GC</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/04/incremental-gc/">深入浅出垃圾回收（三）增量式 GC</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//jiacai2050.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Keep Coding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>