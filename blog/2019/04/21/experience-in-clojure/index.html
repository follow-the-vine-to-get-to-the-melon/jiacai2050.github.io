<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Do have faith in what you are doing."><title>Clojure 开发经验总结 | Keep Coding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-50745138-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '3ffc15f400ce3f8b1db5afc4f29b6ce9';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Clojure 开发经验总结</h1><a id="logo" href="/.">Keep Coding</a><p class="description">Stay hungry, Stay foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/blogrolls/"><i class="fa fa-group"> 友情链接</i></a><a href="/podcast/"><i class="fa fa-podcast"> Podcast</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Clojure 开发经验总结</h1><div class="post-meta">Apr 21, 2019<span> | </span><span class="category"><a href="/categories/langs/">编程语言</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 3.2k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 11</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" data-disqus-identifier="blog/2019/04/21/experience-in-clojure/" href="/blog/2019/04/21/experience-in-clojure/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IDE"><span class="toc-number">1.</span> <span class="toc-text">IDE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Emacs"><span class="toc-number">1.1.</span> <span class="toc-text">Emacs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cider-Lein"><span class="toc-number">1.2.</span> <span class="toc-text">Cider + Lein</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clojure-踩雷区"><span class="toc-number">2.</span> <span class="toc-text">Clojure 踩雷区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lazy"><span class="toc-number">2.1.</span> <span class="toc-text">Lazy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态变量"><span class="toc-number">2.2.</span> <span class="toc-text">动态变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nil"><span class="toc-number">2.3.</span> <span class="toc-text">nil</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#future"><span class="toc-number">2.4.</span> <span class="toc-text">future</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#长期维护-Clojure-项目"><span class="toc-number">3.</span> <span class="toc-text">长期维护 Clojure 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Test"><span class="toc-number">3.1.</span> <span class="toc-text">Test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lint"><span class="toc-number">3.2.</span> <span class="toc-text">Lint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#跟进社区"><span class="toc-number">3.3.</span> <span class="toc-text">跟进社区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#他山之石"><span class="toc-number">4.</span> <span class="toc-text">他山之石</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nathan-Marz"><span class="toc-number">4.1.</span> <span class="toc-text">Nathan Marz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kyle-Kingsbury-a-k-a-“Aphyr”"><span class="toc-number">4.2.</span> <span class="toc-text">Kyle Kingsbury a.k.a “Aphyr”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zach-Tellman"><span class="toc-number">4.3.</span> <span class="toc-text">Zach Tellman</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clojure-工作机会"><span class="toc-number">5.</span> <span class="toc-text">Clojure 工作机会</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="post-content"><p>大概在两年半前，我开始陆陆续续写了<a href="/tags/Clojure/">一系列文章</a>，来介绍如何上手、深入 Clojure，后来有幸加入 LeanCloud 写了两年的 Clojure，期间制作了一套<a href="https://github.com/jiacai2050/learn_clojure.mp4" target="_blank" rel="noopener">七集的教学视频</a>，算是对这门语言有了较为全面的认识。<br>鉴于国内 Clojure 普及程度很低，我觉得有必要把这些年的经验整理出来，可能会有些片面，但贵在真实，希望我的这些实战经验能帮助到后面 Clojure 的学习者。</p>
<p>工欲善其事，必先利其器。首先，会介绍如何打造高效实用的集成开发环境（IDE）；接着会介绍 Clojure 语言特性隐藏的一些坑；之后就如何长期维护 Clojure 项目提供一些思路；然后会介绍 Clojure 社区中一些重量级的人物，通过阅读他们的代码可以极大增强自己的内功；最后想谈下对国内 Clojure 找工作的个人见解。</p>
<h2 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h2><p>在 <a href="/blog/2016/12/31/dev-in-clojure">Clojure 开发那些事</a> 中，介绍了开发 Clojure 的两种组合，即 IDEA+Cursive 与 Emacs+Cider。我一直用的是 Emacs 这一组合，在编写与 Java 交互比较多的情况下，会去采用 IDEA 方案。</p>
<p>关于编辑器之争，这里没必要讨论，适合自己的才是最好的，都是工具而已，写出优雅的代码才是目的。这里仅仅分享个人使用 Emacs 的一些小心得。</p>
<h3 id="Emacs"><a href="#Emacs" class="headerlink" title="Emacs"></a>Emacs</h3><p>Emacs 是起源最早的编辑器之一。有人说它是伪装成编辑器的操作系统，我当初怀揣着试试看的心理，反反复复用了几次，但基本上都无疾而终，相比于 VSCode 之类开箱即用的编辑器， Emacs 确实很不友好。后来才知道，入门 Emacs，最好的方式是先用前辈们的配置文件，然后逐渐去适应、学习。<br>这个过程比较痛苦，我大概持续了一周左右，即使到了今天，也还是有可能陶醉在配置文件的修改中，一改就是3、4个小时，因为它的配置文件就是 Elisp 代码，随着使用程度的增加，这些代码会变得比较复杂，所以隔一段时间，我就会重新整理一下，寻找最佳的管理方式。</p>
<ul>
<li><a href="https://github.com/flyingmachine/emacs-for-clojure" target="_blank" rel="noopener">https://github.com/flyingmachine/emacs-for-clojure</a> 这是我最初参考的配置</li>
<li><a href="https://github.com/jiacai2050/dotfiles/tree/master/.emacs.d" target="_blank" rel="noopener">https://github.com/jiacai2050/dotfiles/tree/master/.emacs.d</a> 这是我目前的配置</li>
</ul>
<p>建议感兴趣的同学专门拿出两天来学习 Emacs 一些基本操作，然后强迫自己在日常工作中使用它，这样应该能很快上手，一旦习惯了，基本上就离不开了，我目前除了 Java 用 IDEA 开发外，其余的 go/python/js/rust 等都用 Emacs 搞定。喜欢折腾的同学不要错过！<br>下面介绍两个 Emacs 中杀手锏：</p>
<ul>
<li><a href="https://magit.vc/" target="_blank" rel="noopener">Magit, A Git Porcelain inside Emacs</a> 深度与 Emacs 整合的 git 客户端，非常好用</li>
<li><a href="https://orgmode.org/" target="_blank" rel="noopener">Org mode</a> 一个强大的标记语言，完虐 markdown</li>
</ul>
<p>最后，国内的 Emacs 社区也是非常推荐，经常会有精彩的讨论，各种使用问题都可以在上面找到答案</p>
<ul>
<li><a href="https://emacs-china.org/" target="_blank" rel="noopener">https://emacs-china.org/</a></li>
</ul>
<h3 id="Cider-Lein"><a href="#Cider-Lein" class="headerlink" title="Cider + Lein"></a>Cider + Lein</h3><p>Cider 全称是 The Clojure Interactive Development Environment that Rocks for Emacs</p>
<p>参考 flyingmachine 的配置，能把 cider+lein 跑起来，在使用过程中，我逐渐总结出一套“最佳实践”，供大家参考：</p>
<ol>
<li>慎重升级。每次升级 cider，我都会<a href="https://github.com/clojure-emacs/cider/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+commenter%3Ajiacai2050+" target="_blank" rel="noopener">或多或少遇到些问题</a>，这很烦人，尤其是你要开始干活的时候，IDE 突然坏了，于是乎你不得不停下手中的活，来修复它。虽然社区反应还算快，但还是挺影响效率的。</li>
<li><p><a href="https://github.com/technomancy/leiningen" target="_blank" rel="noopener">lein</a> 作为 Clojure 默认的项目管理工具，已够用，不需要再去折腾 <a href="https://github.com/boot-clj/boot" target="_blank" rel="noopener">boot-clj</a></p>
<ul>
<li><a href="https://github.com/technomancy/leiningen/blob/master/doc/TUTORIAL.md#checkout-dependencies" target="_blank" rel="noopener">Checkout Dependencies</a> 多项目开发时必备的技巧。项目目录大概是这样子的：<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|<span class="comment">-- project.clj</span></span><br><span class="line">|<span class="comment">-- README.md</span></span><br><span class="line">|<span class="comment">-- checkouts</span></span><br><span class="line">|   `<span class="comment">-- suchwow [link to ~/code/oss/suchwow]</span></span><br><span class="line">|   `<span class="comment">-- commons [link to ~/code/company/commons]</span></span><br><span class="line">|<span class="comment">-- src</span></span><br><span class="line">|   `<span class="comment">-- my_stuff</span></span><br><span class="line">|       `<span class="comment">-- core.clj</span></span><br><span class="line">`<span class="comment">-- test</span></span><br><span class="line">    `<span class="comment">-- my_stuff</span></span><br><span class="line">        `<span class="comment">-- core_test.clj</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Clojure REPL 启动很慢，所以正确的姿势是启动一个 REPL 后，不去关闭它，一直在里面去调试代码，有下面几个 plugin 使用的推荐：</p>
<ul>
<li><a href="https://github.com/palletops/lein-shorthand" target="_blank" rel="noopener">lein-shorthand</a> + <a href="https://github.com/pallet/alembic" target="_blank" rel="noopener">alembic</a> 可以在已启动的 REPL 中动态添加新依赖，不需要重启，必备！</li>
<li><a href="https://github.com/vvvvalvalval/scope-capture" target="_blank" rel="noopener">scope-capture</a> 让 REPL 开发、测试流程如丝般柔滑！</li>
<li><a href="https://github.com/jiacai2050/dotfiles/blob/master/.lein/profiles.clj" target="_blank" rel="noopener">profiles.clj</a> 是我目前的配置，供参考</li>
<li>REPL 启动久了，难免变得比较“脏”，对于改动较多的情况，在正式 push 到 remote 前，建议重启 REPL 测试</li>
</ul>
</li>
</ol>
<h2 id="Clojure-踩雷区"><a href="#Clojure-踩雷区" class="headerlink" title="Clojure 踩雷区"></a>Clojure 踩雷区</h2><p>每门语言都会过度宣扬自己的长处，而刻意回避自己不擅长的地方，这无可厚非。这一小节就会介绍下 Clojure 中容易出问题的几个地方：</p>
<h3 id="Lazy"><a href="#Lazy" class="headerlink" title="Lazy"></a>Lazy</h3><p><a href="https://clojure.org/reference/lazy" target="_blank" rel="noopener">惰性</a>是 Clojure 语言的一重要特性，按需求值，看起来很美好，但是用起来坑缺很多。<br>首先就是官方文档里介绍的 <a href="https://clojure.org/reference/lazy#_dont_hang_onto_your_head" target="_blank" rel="noopener">Don’t hang (onto) your head</a>，类似的变种还有 <a href="https://stuartsierra.com/2015/04/26/clojure-donts-concat" target="_blank" rel="noopener">lazy-seq + concat</a> 的组合，非常容易写出看似优雅、实则暗藏 bug 的代码，到现在我都必须非常小心的使用它们，并且不能完全保证没有错误。</p>
<p>另一个是与动态变量结合时，比如</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">def</span></span> *some-predict* <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">def</span></span> do-somework [exercises]</span><br><span class="line">  (<span class="name">binding</span> [*some-predict* <span class="literal">false</span>]</span><br><span class="line">    (<span class="name"><span class="builtin-name">map</span></span> (<span class="name"><span class="builtin-name">fn</span></span> [x] (<span class="name">do-with</span> x))</span><br><span class="line">         exercises)))</span><br></pre></td></tr></table></figure>
<p>由于 map 是惰性求值的，导致 do-somework 在返回后还没有真正求值（realize），导致没有用到函数内 binding 的值。</p>
<h3 id="动态变量"><a href="#动态变量" class="headerlink" title="动态变量"></a>动态变量</h3><p>动态变量解决的问题就是在不改变函数签名（主要是参数）的情况下，改变函数的行为。但用好它并不容易，除了上面提及的与 lazy 整合的问题，还要注意，其 binding 的值是不能跨线程的，为了解决这个问题，Clojure 1.3 版本提出了 <a href="https://github.com/clojure/clojure/blob/master/changes.md#234-binding-conveyance" target="_blank" rel="noopener">binding conveyance</a>，但仅仅对 Clojure 自身的线程池有效，然后又增加了 <a href="https://clojuredocs.org/clojure.core/bound-fn" target="_blank" rel="noopener">bound-fn</a> 来解决这个问题。可以参考下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(def ^:dynamic *num* <span class="number">1</span>)</span><br><span class="line">(binding [*num* <span class="number">2</span>] </span><br><span class="line">  (future (println *num*)))</span><br><span class="line">;; 因为 binding conveyance，这里打印 <span class="string">"2"</span></span><br><span class="line"></span><br><span class="line">(let [^<span class="function">ExecutorService <span class="title">executor</span> <span class="params">(Executors/newFixedThreadPool <span class="number">1</span>)</span>]</span></span><br><span class="line"><span class="function">  <span class="params">(binding [*num* <span class="number">2</span>]</span></span></span><br><span class="line"><span class="function"><span class="params">    (.submit executor ^Callable (fn [] (println *num*)</span>))</span></span><br><span class="line"><span class="function">    <span class="params">(.shutdown executor)</span>))</span></span><br><span class="line"><span class="function"></span>;; 对于自定义线程池，这里打印 <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">(let [^<span class="function">ExecutorService <span class="title">executor</span> <span class="params">(Executors/newFixedThreadPool <span class="number">1</span>)</span>]</span></span><br><span class="line"><span class="function">  <span class="params">(binding [*num* <span class="number">2</span>]</span></span></span><br><span class="line"><span class="function"><span class="params">    (.submit executor ^Callable (bound-fn [] (println *num*)</span>))</span></span><br><span class="line"><span class="function">    <span class="params">(.shutdown executor)</span>))</span></span><br><span class="line"><span class="function"></span>;; 对于 bound-fn ，这里打印 <span class="string">"2"</span></span><br></pre></td></tr></table></figure>
<p>更多可参考：</p>
<ul>
<li><a href="https://stuartsierra.com/2013/03/29/perils-of-dynamic-scope" target="_blank" rel="noopener">https://stuartsierra.com/2013/03/29/perils-of-dynamic-scope</a></li>
</ul>
<h3 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h3><p>nil 表示无，在不同场景下有不同含义，而且 Clojure 想尽量屏蔽掉这种差异性，比如：</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user&gt; (str nil "abc")</span><br><span class="line"><span class="string">"abc"</span></span><br><span class="line">user&gt; (conj nil "abc")</span><br><span class="line">(<span class="string">"abc"</span>)</span><br><span class="line">user&gt; (assoc nil :a 1)</span><br><span class="line">&#123;<span class="symbol">:a</span> <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>
<p>但时不时 nil 就会出来咬你一口。记得之前有这么一个需求，需要对消息的格式做了升级，之前可能是 map/string，升级后只能是 string 并且用 v2 标示，处理的代码需要找出这两类消息，分别处理，代码大致如下</p>
<figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">let</span></span> [&#123;v1-msgs <span class="literal">false</span> v2-msgs <span class="literal">true</span>&#125;</span><br><span class="line">      (<span class="name">group-by</span> #(<span class="name"><span class="builtin-name">when</span></span> (<span class="name"><span class="builtin-name">string?</span></span> %)</span><br><span class="line">                   (<span class="name">.startsWith</span> <span class="comment">^String</span> % <span class="string">"v2:"</span>)) msgs)])</span><br></pre></td></tr></table></figure>
<p>可以看到，代码很简单，就是判断 msg 是不是字符串，如果是，再看看版本是不是 v2，由于 nil 与 false 是不同的值，导致会丢失一部分数据，正确的写法是这样的：<br><figure class="highlight clj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">let</span></span> [&#123;v1-msgs <span class="literal">false</span> v2-msgs <span class="literal">true</span>&#125;</span><br><span class="line">      (<span class="name">group-by</span> #(<span class="name"><span class="builtin-name">boolean</span></span> (<span class="name"><span class="builtin-name">when</span></span> (<span class="name"><span class="builtin-name">string?</span></span> %)</span><br><span class="line">                   (<span class="name">.startsWith</span> <span class="comment">^String</span> % <span class="string">"v2:"</span>))) msgs)])</span><br></pre></td></tr></table></figure></p>
<p>所以这里的一个提醒就是尽量不要让自己的函数返回 nil，而是返回空值，比如空数组、空链表、空字符串等。</p>
<h3 id="future"><a href="#future" class="headerlink" title="future"></a>future</h3><p>future 可以很方便的起一个新线程来工作，但其运行的线程池是无限制的，如果无节制的使用会导致线上服务 oom，这里推荐一个并发的库 <a href="https://github.com/TheClimateCorporation/claypoole" target="_blank" rel="noopener">com.climate/claypoole</a> 可以完美替换 <code>pmap/future/run!</code> 等！</p>
<h2 id="长期维护-Clojure-项目"><a href="#长期维护-Clojure-项目" class="headerlink" title="长期维护 Clojure 项目"></a>长期维护 Clojure 项目</h2><p>Clojure 作为一门动态语言，同样有“编写爽，维护难”痛点，解决方式也是统一的：完备的测试，外加 lint（代码质量检测）。</p>
<h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><p>测试这个问题很尴尬，是每个开发者都知道很重要但很少落实到位的一项技能，除了基本的单元测试，还要有覆盖整条链路的黑盒测试，不仅仅测正常的输入，更多的是异常情况。<br>下面说下 Clojure 单元测试开发中会用到的一些技巧：</p>
<ol>
<li><a href="https://clojure.github.io/clojure/clojure.test-api.html" target="_blank" rel="noopener">clojure.test</a> 提供了最基本的断言，<a href="https://clojuredocs.org/clojure.test/use-fixtures" target="_blank" rel="noopener">use-fixtures</a> 可以进行一些 setup 与 teardown</li>
<li><a href="https://clojuredocs.org/clojure.core/with-redefs" target="_blank" rel="noopener">with-redefs</a> 可以去 mock 一些外部依赖的返回</li>
<li><a href="https://github.com/venantius/ultra/wiki/Tests" target="_blank" rel="noopener">ultra</a> 更直观的测试结果展示</li>
</ol>
<h3 id="Lint"><a href="#Lint" class="headerlink" title="Lint"></a>Lint</h3><p>Clojure 作为一 Lisp 方言，有非常强的表现力，几行代码就可以干很多事情，为了保证整个团队有统一的编程风格，应该在项目起始阶段，就加上质量检测。<br>Clojure 社区里面，<a href="https://github.com/jonase/eastwood" target="_blank" rel="noopener">eastwood</a> 是一个非常全面的 lint 工具，它帮助我发现了很多程序中肉眼难以识别的错误，成熟 Clojure 程序员必备。</p>
<h3 id="跟进社区"><a href="#跟进社区" class="headerlink" title="跟进社区"></a>跟进社区</h3><ul>
<li>Clojure 1.9 引入 <a href="https://clojure.org/news/2017/12/08/clojure19" target="_blank" rel="noopener">spec</a>，尝试来解决一直被初学者诟病的错误信息看不懂的问题</li>
<li>Clojure 1.10 更进一步，<a href="https://clojure.org/news/2018/12/17/clojure110" target="_blank" rel="noopener">对错误信息进行了分类</a>，适配 Java 9 带来的 module</li>
</ul>
<p>除了 Clojure 语言本身外，Lein/JVM 等周边生态链也在不断推进，我们需要及时去了解这些新技术，现在我比较头疼的是下面这两个：</p>
<ol>
<li>Lein 在 3.0 大版本中会<a href="https://github.com/technomancy/leiningen/blob/master/doc/PLUGINS.md#hooks" target="_blank" rel="noopener">移除对 hook 的支持</a>，这将会导致很多有用的插件不可用，包括上面推荐的 lein-shorthand</li>
<li>Java 9 为了支持 module，<a href="https://stackoverflow.com/questions/46494112/classloaders-hierarchy-in-java-9" target="_blank" rel="noopener">改变了 classloader 的行为</a>，导致<a href="https://github.com/clojure-emacs/clj-refactor.el/issues/410" target="_blank" rel="noopener">无法使用 alembic 提供的动态加载依赖</a>的功能，所以目前只能锁定在 Java 8 上</li>
</ol>
<h2 id="他山之石"><a href="#他山之石" class="headerlink" title="他山之石"></a>他山之石</h2><p>Clojure 社区虽小，但不乏高手，通过阅读高手的代码，是熟悉一门语言 idioms 最有效的方式。下面介绍社区内，对我影响最大的三位：</p>
<h3 id="Nathan-Marz"><a href="#Nathan-Marz" class="headerlink" title="Nathan Marz"></a><a href="http://nathanmarz.com/" target="_blank" rel="noopener">Nathan Marz</a></h3><p>一个非常务实的 coder，文章见解独特、观点新颖。明星项目：</p>
<ul>
<li><a href="https://github.com/nathanmarz/storm" target="_blank" rel="noopener">Storm</a> 流式数据框架</li>
<li><a href="https://github.com/nathanmarz/specter" target="_blank" rel="noopener">Specter</a> 号称 Clojure(Script)’s missing piece，操作复杂数据结构的利器！</li>
<li><a href="https://www.manning.com/books/big-data" target="_blank" rel="noopener">Big Data: Principles and best practices of scalable realtime data systems</a>，在本书中提出有名的 <a href="https://en.wikipedia.org/wiki/Lambda_architecture" target="_blank" rel="noopener">Lambda 架构</a></li>
<li><a href="https://github.com/nathanmarz/cascalog" target="_blank" rel="noopener">Cascalog</a> 这是我 2014 年首次接触 Clojure 时用的项目，主要是分析日志。语法借鉴自声明式逻辑语言 <a href="https://en.wikipedia.org/wiki/Datalog" target="_blank" rel="noopener">Datalog</a></li>
</ul>
<h3 id="Kyle-Kingsbury-a-k-a-“Aphyr”"><a href="#Kyle-Kingsbury-a-k-a-“Aphyr”" class="headerlink" title="Kyle Kingsbury a.k.a “Aphyr”"></a><a href="https://aphyr.com" target="_blank" rel="noopener">Kyle Kingsbury</a> a.k.a “Aphyr”</h3><p>神人一个，高产 coder。明星项目：</p>
<ul>
<li><a href="http://riemann.io/" target="_blank" rel="noopener">Riemann</a> 一个强大的监控系统，具备丰富的<a href="http://riemann.io/api/riemann.streams.html" target="_blank" rel="noopener">数据流操作</a></li>
<li><a href="https://jepsen.io/" target="_blank" rel="noopener">Jepsen</a> 著名的分布式系统测试框架</li>
<li><a href="https://aphyr.com/tags/Clojure-from-the-ground-up" target="_blank" rel="noopener">Clojure from the Ground Up</a> 介绍 Clojure 的一系列文章</li>
<li><a href="https://github.com/aphyr" target="_blank" rel="noopener">https://github.com/aphyr</a> </li>
</ul>
<h3 id="Zach-Tellman"><a href="#Zach-Tellman" class="headerlink" title="Zach Tellman"></a><a href="https://ideolalia.com/" target="_blank" rel="noopener">Zach Tellman</a></h3><p>神人另一个，高产 coder，貌似与 Aphyr 共事过</p>
<ul>
<li><a href="https://elementsofclojure.com/" target="_blank" rel="noopener">Elements of Clojure</a> This book tries to put words to what most experienced programmers already know</li>
<li><a href="https://github.com/ztellman" target="_blank" rel="noopener">https://github.com/ztellman</a><br>我目前还没直接使用过 Zach 写的库，这是由于他的库很多都是基本性质的，所以很有极有可能间接引用了他的库，比如 specter 就用了他的 riddley。下面一张图摘自他的博客：<br><img src="https://ideolalia.com/images/libraries.png" alt="Zach&#39;s libraries"></li>
</ul>
<p>混 Clojure 社区，应该还会经常看到 Congnitect 公司内的 <a href="https://github.com/richhickey" target="_blank" rel="noopener">Rich</a>/<a href="https://github.com/stuarthalloway" target="_blank" rel="noopener">Stuart Halloway</a>/<a href="https://github.com/puredanger" target="_blank" rel="noopener">Alex Miller</a>/<a href="http://blog.fogus.me/" target="_blank" rel="noopener">Michael Fogus</a>…</p>
<h2 id="Clojure-工作机会"><a href="#Clojure-工作机会" class="headerlink" title="Clojure 工作机会"></a>Clojure 工作机会</h2><p>首先明确一点，语言只是工具，而只会工具是找不到工作的，很多初学 Clojure 的同学都有这个误区。打个比方：一个厨师的刀工非常好，但是不知道如何去做菜（领域知识），有什么用呢？</p>
<p>比如，做 Web 开发，那对 HTTP 了解多少？ TCP/UDP 区别是什么？Mysql 锁有几种？这些都是必须的。再进一步，JVM 上的 gc 懂吗？多线程用过没？linux 上如何排除进程相关信息？</p>
<p>有了以上基础，我们也不得不承认，使用 Clojure 作为主力开发语言的公司确实少，但也不是没有，比如：北京的 LeanCloud/BearyChat、深圳的 <a href="https://www.bagevent.com/event/1760284" target="_blank" rel="noopener">风林火山</a> 。<br>即使工作中无法使用，了解这门优雅、富有表现力的语言来扩展自己的眼界，也是不错的选择。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>从 14 年实习期间接触 Clojure，到现在 19 年差不多 5 年了，学到了太多太多东西，一方面是编程语言的设计，另一方面是后端开发的整个体系。坊间甚至一度传闻 <a href="https://news.ycombinator.com/item?id=14418013" target="_blank" rel="noopener">Clojure is dead</a>。<br>Clojure 不是银弹，肯定是有一些瑕疵，但这并不妨碍它是一门优秀的语言，虽然我现在工作中用不到它了，但是业余时间肯定还是会去研究它，社区有太多有意思的项目了。<br>希望新入门的同学可以坚持下去，早日体味到 Clojure 的乐趣。加油！</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://liujiacai.net/blog/2019/04/21/experience-in-clojure/" data-id="ckdkzhqol005i6ylj8d9y000v" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3awY7DIAxF0fz/T6fSrGbR0PvstFLMZRVVgXBYuBhzHLidf43/cv5r6zHTXq0mQ4aMxzLOZbua9FVf/j5ZMjI3GTJk7MNIh7u3b2d8GTJkyEiD4LrXelO4fpYhQ4YMHjRJiOQpLifJkCFDBhk6PXQjv3eCuwwZMvZhpIWBXz5/sb4hQ4aMhzDOsKXbx05oDmYlQ4aM0Yy7PkAO0ToJLQrHMmTIGMroX4/gx3BpyhokzzJkyNiMwa9trT/AL0+sR0DLKkOGjNGM2natVlSobTTjgzkZMmQMZdQucqXJcFqG5Jc2ZMiQsQODp6NkO5geoqXXyILLYTJkyBjBSCeaBt/OoRu/XyFDhozZjPUnO2XFdIppoJchQ8ZujLvKlrXktpayypAhYx9G//ieTLqGD8AyZMgYzagVLPlFDXTOVxoN7XBlyJAxgsE3bXdFtjRhRkd4MmTI2J5BNm3f2D4GyyRDhozRDNI5haUbO1JyQAmwDBkyhjKCW2NhCYGUMGsbxOIkZMiQ8XBG7ciMp6N9xoe/ARkyZIxm9AEHbp2kt1jClCFDxgjGGbZaCsqfyWK96StDhozRjHvDJU9HaxNFZ4cyZMgYyuDT+rDHBKlprcCA1l6GDBkbMHiQJW/WADzoXwZcGTJkbM9I30mDZi2pliFDhgye9ZJ0tJZJkwWSIUPGDgx+fNaZaHoJDAFkyJCxAaMW8johkiS9tWWVIUPGOMYLRYMZBr7LOpMAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Clojure/">Clojure</a></div><div class="post-nav"><a class="pre" href="/blog/2019/07/17/hello-golang/">写给新手的 Go 开发指南</a><a class="next" href="/blog/2019/01/09/java-gc-definitive-guide/">Java 垃圾回收权威指北</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://liujiacai.net/blog/2019/04/21/experience-in-clojure/';
    this.page.identifier = 'blog/2019/04/21/experience-in-clojure/';
    this.page.title = 'Clojure 开发经验总结';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//jiacai2050.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//jiacai2050.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://jiacai2050.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://liujiacai.net"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reproduce/">他山之石</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">大数据</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/search-engine/">搜索引擎</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">热爱生活</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/aha-computer/">理解计算机</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/研习经典/">研习经典</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/langs/">编程语言</a><span class="category-list-count">26</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/music/" style="font-size: 15px;">music</a> <a href="/tags/GEB/" style="font-size: 15px;">GEB</a> <a href="/tags/lucene/" style="font-size: 15px;">lucene</a> <a href="/tags/mooc/" style="font-size: 15px;">mooc</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/algorithm/" style="font-size: 15px;">算法</a> <a href="/tags/mozilla/" style="font-size: 15px;">mozilla</a> <a href="/tags/best-practice/" style="font-size: 15px;">最佳实践</a> <a href="/tags/lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/lisp/" style="font-size: 15px;">Lisp</a> <a href="/tags/linux/" style="font-size: 15px;">Linux</a> <a href="/tags/javascript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/sicp/" style="font-size: 15px;">sicp</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/scheme/" style="font-size: 15px;">Scheme</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/python/" style="font-size: 15px;">Python</a> <a href="/tags/ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/Clojure/" style="font-size: 15px;">Clojure</a> <a href="/tags/ideas/" style="font-size: 15px;">ideas</a> <a href="/tags/gc/" style="font-size: 15px;">GC</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2020/08/08/go-meet-java/">在 Java 中调用 Go 代码</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/03/14/go-struct-interface/">Go struct/interface 最佳实践</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/02/review-2019/">2019 年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/10/24/go-modules/">何处安放我们的 Go 代码</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/07/17/hello-golang/">写给新手的 Go 开发指南</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/21/experience-in-clojure/">Clojure 开发经验总结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/09/java-gc-definitive-guide/">Java 垃圾回收权威指北</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/29/how-java-synchronizer-work/">Java 线程同步原理探析</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/10/damn-single-socket/">形单影只的 Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/18/generational-gc/">深入浅出垃圾回收（四）分代式 GC</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//jiacai2050.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Keep Coding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>